<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html;">

    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="css/estilo.css" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <!--Script  editor -->
    <script src="js/tinymce/tinymce.min.js"></script>
    <script type="text/javascript" src="js/funcoes.js"></script>
    <script>
        tinymce.init({ selector:'textarea' });
    </script>
    <!--/.script editor fim -->

</head>

<body>
    <nav class="blue" role="navigation">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo">Phsim web</a>
            <ul class="right hide-on-med-and-down">
                <li><a href="index.html">Home</a></li>
                <li><a href="javaScript:paginar('desenv');">Desenvolvimento</a></li>
                <li><a href="javaScript:paginar('simulacao');">Simula&ccedil;&atilde;o</a></li>
                <li><a href="configuracoes.html">Configura&ccedil;&otilde;es</a></li>
                <li><a href="sobre.html">Sobre</a></li>
            </ul>
            <ul id="nav-mobile" class="side-nav" style="left:-250px">
                <li><a href="index.html">Home</a></li>
                <li><a href="javaScript:paginar('desenv');">Desenvolvimento</a></li>
                <li><a href="simulacao.html">simula&ccedil;&atilde;o</a></li>
                <li><a href="configuracoes.html">configura&ccedil;oes</a></li>
                <li><a href="sobre.html">Sobre</a></li>
            </ul>
            <a href="#" class="button-collapse" data-activates="nav-mobile">
                <i class="material-icons">menu</i>
            </a>
        </div>
    </nav>
    <!-- menu mobile-->
    <div class="container" style="margin-bottom: -20px;">
        <div class="fixed-action-btn horizontal click-to-toggle hide-on-large-only " style="bottom: 45px; right: 24px;">
            <a class="btn-floating btn-large red">
                <i class="large mdi-navigation-menu"></i>
            </a>
            <ul>
                <li><a class="btn-floating modal-trigger red" href="#modalEditarTabela"><i class="material-icons">stop</i></a></li>
                <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li>
                <li><a class="btn-floating green"><i class="material-icons">publish</i></a></li>
                <li><a href="#modal1" class="btn-floating modal-trigger blue"><i class="material-icons">attach_file</i></a></li>
            </ul>
        </div>
    </div>
    <!--/.menu mobile fim  -->
    <!-- inicio page_simulação -->
    <div id="page_simulacao" class="page">
        <!-- inicia menu desktop -->
        <div class="container menu_desktop">
            <div class="row">
                <div class="navbar hide-on-med-and-down">
                    <nav id="menu_desktop">
                        <div class="nav-wrapper ">
                            <ul class="left hide-on-med-and-down">
                                <li><a onclick="loadFileAsText();"><i class="material-icons">add</i></a></li>
                                <li><a id="lesen" href="#"><i class="material-icons">add</i></a></li>
                                <li><a class="modal-trigger" href="#modalEditarTabela"><i class="material-icons">stop</i></a></li>
                                <li><a href="#"><i class="material-icons">add</i></a></li>
                                <li><a href="#"><i class="material-icons">add</i></a></li>
                                <li><a href="#"><i class="material-icons">add</i></a></li>
                                <li><a href="#"><i class="material-icons">add</i></a></li>
                                <li><a href="#"><i class="material-icons">add</i></a></li>
                                <li><a class="modal-trigger"  href="#modalSalvarArquivo"><i class="material-icons">save</i></a></li>
                                <li><a class="modal-trigger" href="#modal1"><i class="material-icons">input</i></a></li>
                                <!-- <li><input id="fileToLoad" type="file"></li>-->
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <!-- /.menu desktop -->
        <!--conteudo pagina -->
        <div class="container">
            <div class="row">
                <div id="svg_simulacao" class="svg_simulacao col s12 m12 l8">
                    <object data="assets/SVG_prot.svg" preserveAspectRatio="xMidYMid meet" type="image/svg+xml">
                    <img class="responsive-img" src="standAlone.png" alt="PNG image of standAlone.svg" />
                </object>

                </div>
                <div id="conteudo-tabela" class="col  s12 m12 l4" style="overflow:auto; padding-top:15px;">
                    <div class="switch hide-on-large-only" style="margin-bottom: 10px;">
                        <label>
                        Hexadecimal
                        <input type="checkbox">
                        <span class="lever"></span> Decimal
                    </label>
                    </div>
                    <table  class=" table_memoria centered striped bordered">
                        <thead>
                            <tr>
                                <th data-field="id">Endere&ccedil;o</th>
                                <th data-field="vlr_bin">Bin&aacute;rio</th>
                                <th data-field="vle_h_dec">Hexadecimal</th>
                                <th data-field="vlr_dec">decimal</th>
                            </tr>
                        </thead>
                        <tbody id="lista">
                            <tr id="editando_0" onclick="editarTabela('0');">
                                <td>0</td>
                                <td>00000000</td>
                                <td>00</td>
                                <td>000</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="text"></p>


                    <!--<p style="height:490px;background-color:silver; margin-top: 11px;"> testando 1</p>-->
                </div>
            </div>
            <!--  modal_abrirArquivo inicio -->
            <div id="modal1" class="modal bottom-sheet" style="z-index: 1003; display: block; opacity: 0; bottom: -100px;">
                <div id="carrega_dados" class="modal-content">
                    <h5>Carregar arquivo</h5>
                    <ul class="collection">
                        <li class="collection-item avatar">
                            <div class="file-field input-field">
                                <div class="btn">
                                    <span>File</span>
                                    <input id="fileToLoad" type="file">
                                </div>
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text">
                                </div>
                                <div>
                                    <a class="waves-effect waves-light btn-large" onclick="loadFileAsText();">Carregar</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.modal_AbrirArquivo fim -->
            <!--  modal_salvarArquivo inicio -->
            <div id="modalSalvarArquivo" class="modal bottom-sheet" style="z-index: 1003; display: block; opacity: 0; bottom: -100px;">
                <div id="salvar_dados" class="modal-content">
                    <h5>Salvar arquivo</h5>
                    <ul class="collection">
                        <li class="collection-item avatar">
                            <div class="input-field">
                                    <span>Nome:</span>
                                    <input id="fileToSave" type="text">
                                <div>
                                    <a class="waves-effect waves-light btn-large" onclick="salvar_Arquivo();">Salvar</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.modal_salvarArquivo fim -->
            
            <!-- modal_editarTabela Inicio -->
            <div id="modalEditarTabela" class="modal">
                <div class="modal-content">
                    <h5>Editar Endere&ccedil;o:</h5>
                    <p class="margin_0">
                        <label>Endereco:</label>
                        <input type="text" id="endereco_edicao" class="" maxlength="3"  name="Endereco" />

                    </p>
                    <p class="margin_0">
                        <label>Decimal:</label>
                        <input type="text" id="valor_dec" class="" maxlength="3" name="Valor" />
                        <label>Hexadecimal:</label>
                        <input type="text" id="valor_hexa" class="" maxlength="2" name="Valor" />
                    </p>
                    <p>
                        <label>Binario:</label>
                        <input type="text" id="valor_bin" class="" maxlength="8" name="Valor" />
                    </p>

                    <p id="select_binario">

                        <input onclick="binario();" name="group1" type="checkbox" id="test08" />
                        <label class="labelEdicao" for="test08">128</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test07" />
                        <label onclick="binario();" class="labelEdicao" for="test07">64</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test06" />
                        <label class="labelEdicao" for="test06">32</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test05" />
                        <label class="labelEdicao" for="test05">16</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test04" />
                        <label class="labelEdicao" for="test04">08</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test03" />
                        <label class="labelEdicao" for="test03">04</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test02" />
                        <label class="labelEdicao" for="test02">02</label>
                        <input onclick="binario();" name="group1" type="checkbox" id="test01" />
                        <label class="labelEdicao" for="test01">01</label>

                    </p>
                </div>
                <div class="modal-footer">
                   <div class="left">  
                        <a onclick="endereco_next();" class="waves-effect waves-teal btn-flat">next</a>
                        <a onclick="endereco_prev();" class="waves-effect waves-teal btn-flat">prev</a>
                    </div>
                    <div class="rigth">
                        <a  href="#" onclick="confirma_edicao();"  class=" modal-action  waves-effect waves-green btn-flat">Confirmar</a>
                        <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Cancelar</a>
                    </div>
                </div>
            </div>
            <!-- /.modal_editarTabela fim -->

        </div>
        <!--/.conteudo pagina fim -->
    </div>
    <!-- /.page_simulacao -->
    <!-- page_desenv inicio-->
    <div id="page_desenv" class="page">
        <div class="container">
            <div class="section">
                <div class="row">
                    <div class="col s10 m12">
                        <h5>Desenvolvimento</h5>
                        <textarea id="codigo"> 
                  Crie aqui o seu código...
              </textarea>
                    </div>


                </div>
            </div>
        </div>
    </div>
    <!-- /.page_desenv -->
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
    <script type="text/ecmascript" src="js/mapApp.js"></script>
    <script type="text/ecmascript" src="js/textbox.js"></script>
    <script type="text/ecmascript" src="js/timer.js"></script>
    <script type="text/ecmascript" src="js/helper_functions.js"></script>
    <script type="text/javascript" src="js/baseConverter.js"></script>
    <script type="text/javascript" src="js/FileSaver.min.js"></script>
    </div>
    <script>
        
        var mem_ram = new Array({end:"",val:"",str:""});
        $(document).ready(function(){
          
          $(".button-collapse").sideNav();
          $('.modal-trigger').leanModal();  
          $(".page").hide();
          $("#page_simulacao").show();
          
           $("#endereco_edicao").focusout(function(){
               console.log("chama fn valor: " +$("#endereco_edicao").val());
                
                carregar_valores_modal($("#endereco_edicao").val());
               // var val = $("#valor_dec").val(); 
                //$("#valor_bin").val(ConvertBase.dec2bin(val));
                //$("#valor_hexa").val(ConvertBase.dec2hex(val));
               // setaBin(ConvertBase.dec2bin(val));
            });        
          
           $("#valor_dec").focusout(function(){
                var val = $("#valor_dec").val(); 
                $("#valor_bin").val(ConvertBase.dec2bin(val));
                $("#valor_hexa").val(ConvertBase.dec2hex(val));
                setaBin(ConvertBase.dec2bin(val));
            });
            
            $("#valor_hexa").focusout(function(){
                var val = $("#valor_hexa").val(); 
                $("#valor_bin").val(ConvertBase.hex2bin(val));
                $("#valor_dec").val(ConvertBase.hex2dec(val));
                setaBin(ConvertBase.hex2bin(val)); 
            });
            
            $("#valor_bin").focusout(function(){
                var val = $("#valor_bin").val(); 
                $("#valor_dec").val(ConvertBase.bin2dec(val));
                $("#valor_hexa").val(ConvertBase.bin2hex(val));
                setaBin(val);
            });
          
    }); 
    
    function loadFileAsText()
{
    var lista = $("#lista tr");
    lista.remove();
	var fileToLoad = document.getElementById("fileToLoad").files[0];
	var fileReader = new FileReader();
	fileReader.onload = function(fileLoadedEvent) 
	{
		var textFromFileLoaded = fileLoadedEvent.target.result;
		var texto = textFromFileLoaded;
		listar(texto);
	};
    console.log('tempo'+ new Date());
	fileReader.readAsText(fileToLoad, "UTF-8");
}
function listar(texto){
    console.log('tempo2'+ new Date());
	var quantidade = document.getElementById("lista").rows.length;
    $("#editando_0").remove();	
	var itens = texto.split('\n');   
        cc = 1;
    for(var i=1;i<itens.length;i++){
		var valores = itens[i].split(",");
       
        mem_ram[cc].end = valores[0];
        mem_ram[cc].val = valores[1];
        mem_ram[cc].str = 0;
		document.getElementById("lista").innerHTML +=''+
        '<tr id="'+'editando_'+valores[0]+'" onclick="editarTabela('+valores[0]+');">'+
        '    <td class="end">'+valores[0]+'</td>'+
        '    <td class="bin">'+ConvertBase.hex2bin(valores[1])+'</td>'+
        '    <td class="hex" >'+valores[1].toString().toUpperCase()+'</td>'+
        '    <td class="dec">'+ConvertBase.hex2dec(valores[1])+'</td>'+          
        '</tr>';
        cc+=1;
	}
      
     console.log('tempo3'+ new Date());
     $('#modal1').closeModal();
}
    
    function salvar_Arquivo(){
        console.log("entrou salvar");
        var lista = $("#lista tr");
        var arq = $("#fileToSave").val(); 
        var tam = lista.length;
        var conteudo ="v2.0 raw \r\n";
        for(var i =0;i<tam;i++){
          end = ConvertBase.dec2hex(lista[i].cells[0].innerText);
          val = lista[i].cells[2].innerText;
          conteudo =conteudo + end +","+ val;
          conteudo =conteudo +"\r\n";  
        };
        lista[0].cells[2].innerText;
        var blob = new Blob([conteudo], {type: "text/plain;charset=utf-8"});
        saveAs(blob, arq+".txt");
        $('#modalSalvarArquivo').closeModal();
    }
    
    function paginar(pagina){
        $(".page").hide();
        $("#page_"+pagina).show();
    }
    
    
    function editarTabela(endereco){
        $("#modalEditarTabela").openModal();
        
        cel = $("#editando_"+endereco+" td")[3];
        var valor = cel.innerText;
        cel = $("#editando_"+endereco+" td")[1];
        var bin = cel.innerText; 
        console.log('bin = ' +bin);
        $("#endereco_edicao").val(endereco);
        $("#valor_dec").val(valor);
        $("#valor_bin").val(bin);
        $("#valor_hexa").val(ConvertBase.dec2hex(valor));
        setaBin(bin);
        console.log('abriu modal');     
    }
    
    function setaBin(valor){   
         $("#select_binario input").prop("checked", false); 
       for( var i=1; i<=8;i++){ 
          
           if(valor.charAt(8-i)=='1'){
               console.log('setou valor para test0'+i);
               $("#test0"+i).prop("checked", true);
               console.log('atribuiu valor');         
            }    
       }
    }
    
    function confirma_edicao(){
        var valor = binario();
        var bin = ConvertBase.dec2bin(valor);
        var hexa = ConvertBase.dec2hex(valor);
        // var vlr = '#editando_'+endereco;    
        endereco = $("#endereco_edicao").val();
        end_insert = parseInt(endereco)+1;
        var  tlinha = $("#editando_"+endereco+" td");
        col = tlinha[1];    
        col.innerHTML = bin;
        col = tlinha[2];
        col.innerHTML = hexa;
        col = tlinha[3];
        col.innerHTML = valor;
        $("#modalEditarTabela").closeModal();   
        //$("#"+endereco+"").remove();
        //var html ='<tr onclick="editarTabela('+endereco+','+valor+')"  id="editando_'+endereco+'"> <td>'+endereco+'</td><td>'+bin+'</td><td>'+hexa+'</td><td>'+valor+'</td></tr>';
        //$(html).insertBefore("#editando_"+end_insert.toString());
    } 
        
    function binario(){
        var valor =0;
       for(i=1; i<=8; i++){
           if ($("#test0"+i)[0].checked){
              if(i == 1){
                  valor = valor +1;
              } 
              if(i == 2){
                  valor = valor +2;
              } 
              if(i == 3){
                  valor = valor +4;
              } 
              if(i == 4){
                  valor = valor +8;
              } 
              if(i == 5){
                  valor = valor +16;
              } 
              if(i == 6){
                  valor = valor +32;
              } 
              if(i == 7){
                  valor = valor +64;
              } 
              if(i == 8){
                  valor = valor +128;
              } 
           } 
           
       }
       $("#valor_dec").val(valor);
       $("#valor_hexa").val(ConvertBase.dec2hex(valor));
       $("#valor_bin").val(ConvertBase.dec2bin(valor));
       return valor;
    }
    </script>

</body>

</html>